<div class="alert alert-warning" role="alert" id="slowRequestWarning">
    <strong>Note:</strong> Request may be slow depending on your filter selection.
</div>

<form id="formRequest">
    <fieldset>
        <legend>FAISS Search Settings</legend>
        <div class="settings-container">
            <div class="setting">
                <label for="embedder-model" title="Select the embedder model for FAISS search.">Embedder Model:</label>
                <select id="embedder-model" class="form-control">
                    <option value="all-MiniLM-L6-v2" selected>all-MiniLM-L6-v2</option>
                    <option value="all-MiniLM-L12-v2">all-MiniLM-L12-v2</option>
                    <option value="all-distilroberta-v1">all-distilroberta-v1</option>
                    <option value="all-mpnet-base-v2">all-mpnet-base-v2</option>
                </select>
            </div>
            <div class="setting">
                <label for="nearest-neighbor-number" title="Set the number of nearest neighbors to retrieve.">Nearest Neighbor Number:</label>
                <input type="number" id="nearest-neighbor-number" class="form-control" value="3" min="1" step="1">
            </div>
            <div class="setting">
                <label for="similarity-threshold" title="Set the similarity threshold for FAISS search.">Similarity Threshold:</label>
                <input type="number" id="similarity-threshold" class="form-control" value="0.8" step="0.1" min="0">
            </div>
            <div class="setting">
                <label for="distance-metric" title="Select the distance metric for FAISS search.">Distance Metric:</label>
                <select id="distance-metric" class="form-control">
                    <option value="cosine" selected>Cosine Similarity</option>
                    <option value="euclidean">Euclidean Distance</option>
                </select>
            </div>
        </div>
    </fieldset>
    <fieldset>
        <legend>Transformer Settings</legend>
        <div class="settings-container">
            <div class="setting">
                <label for="language-model" title="Select the pre-trained language model for text generation.">Language Model:</label>
                <select id="language-model" class="form-control">
                    <option value="">Select a Model</option>
                    <optgroup label="distilgpt2">
                        <option value="distilgpt2" selected>distilgpt2 (~82 MB)</option>
                    </optgroup>
                    <optgroup label="GPT-Neo">
                        <option value="EleutherAI/gpt-neo-125M">GPT-Neo 125M (~500 MB)</option>
                        <option value="EleutherAI/gpt-neo-1.3B">GPT-Neo 1.3B (~5 GB)</option>
                        <option value="EleutherAI/gpt-neo-2.7B">GPT-Neo 2.7B (~10 GB)</option>
                    </optgroup>
                    <optgroup label="GPT-J">
                        <option value="EleutherAI/gpt-j" disabled>GPT-J (6B, ~24 GB)</option>
                    </optgroup>
                    <optgroup label="GPT-3">
                        <option value="openai/gpt-3" disabled>GPT-3 (175B, ~350 GB, not free)</option>
                    </optgroup>
                </select>
            </div>
            <div class="setting">
                <label for="skip-special-tokens" title="Remove special tokens from the output text.">Skip Special Tokens:</label>
                <input type="checkbox" id="skip-special-tokens" checked>
            </div>
            <div class="setting">
                <label for="max-new-tokens" title="Set the maximum tokens generated by the transformer model.">Max New Tokens:</label>
                <input type="number" id="max-new-tokens" class="form-control" value="10" min="1" step="1">
            </div>
            <div class="setting">
                <label for="temperature" title="Controls the randomness of transformer output.">Temperature:</label>
                <input type="number" id="temperature" class="form-control" value="0.7" step="0.1" min="0" max="1">
            </div>
            <div class="setting">
                <label for="top-k" title="Limits sampling to the top K probable tokens.">Top K:</label>
                <input type="number" id="top-k" class="form-control" value="50" min="1" step="1">
            </div>
            <div class="setting">
                <label for="top-p" title="Limits sampling to a cumulative probability threshold.">Top P:</label>
                <input type="number" id="top-p" class="form-control" value="0.9" step="0.01" min="0" max="1">
            </div>
            <div class="setting">
                <label for="repetition-penalty" title="Discourages repetitive phrases in transformer output.">Repetition Penalty:</label>
                <input type="number" id="repetition-penalty" class="form-control" value="1.5" step="0.1" min="1">
            </div>
            <div class="setting">
                <label for="length-penalty" title="Adjusts preference for longer or shorter sequences.">Length Penalty:</label>
                <input type="number" id="length-penalty" class="form-control" value="1.0" step="0.1" min="0">
            </div>
            <div class="setting">
                <label for="stop-sequence" title="Specify a sequence where generation stops early.">Stop Sequence:</label>
                <input type="text" id="stop-sequence" class="form-control" value=". " placeholder="Enter stop sequence">
            </div>
            <div class="setting">
                <label for="seed" title="Set a random seed for reproducibility.">Random Seed:</label>
                <input type="number" id="seed" class="form-control" value="42" min="0" step="1">
            </div>
            <div class="setting">
                <label for="beam-width" title="Set the number of beams for beam search decoding.">Beam Width:</label>
                <input type="number" id="beam-width" class="form-control" value="2" min="1" step="1">
            </div>
        </div>
    </fieldset>
    <div>
        <textarea class="t-area form-control" id="question" placeholder="Type your question here..." rows="4"></textarea><br>
    </div>
    <button type="button" id="chatButton" class="btn btn-primary" onclick="sendChat()">Send</button>
    <span id="chatLoading" style="display: none;">Loading...</span>
    <h2>Response:</h2>
    <p id="response"></p>
</form>
<hr>
<div>
    <h2>Add Knowledge</h2>
    <textarea class="t-area form-control" id="newContent" placeholder="Add new knowledge..." rows="4"></textarea><br>
    <button type="button" id="addButton" class="btn btn-success" onclick="addKnowledge(event)">Add</button>
    <span id="addLoading" style="display: none;">Loading...</span>
    <h2>Status:</h2>
    <p id="status"></p>
</div>
